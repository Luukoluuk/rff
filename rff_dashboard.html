<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RFF — Financial Projections 2026–2028</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c10;
    --surface: #111318;
    --border: #1e2130;
    --accent: #c8ff5a;
    --accent2: #5af0ff;
    --accent3: #ff7a5a;
    --text: #e8eaf0;
    --muted: #5a607a;
    --green: #4ade80;
    --red: #f87171;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Noise overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 1; }

  /* Header */
  header {
    padding: 40px 0 32px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 40px;
  }
  .header-inner { display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 16px; }
  .brand {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--accent);
  }
  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(28px, 5vw, 52px);
    font-weight: 800;
    line-height: 1.05;
    letter-spacing: -0.02em;
    color: var(--text);
    margin-top: 8px;
  }
  h1 span { color: var(--muted); }
  .subtitle { color: var(--muted); font-size: 12px; letter-spacing: 0.05em; margin-top: 8px; }

  /* Year tabs */
  .tabs { display: flex; gap: 4px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 4px; width: fit-content; }
  .tab {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    padding: 8px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--muted);
    border: none;
    background: none;
    letter-spacing: 0.05em;
  }
  .tab.active { background: var(--accent); color: #0a0c10; }
  .tab:hover:not(.active) { color: var(--text); background: var(--border); }

  /* KPI Grid */
  .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 40px; }
  .kpi-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px 20px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
    opacity: 0;
    transition: opacity 0.2s;
  }
  .kpi-card:hover { border-color: var(--accent); }
  .kpi-card:hover::before { opacity: 1; }
  .kpi-label { font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); margin-bottom: 12px; }
  .kpi-value {
    font-family: 'Syne', sans-serif;
    font-size: 28px;
    font-weight: 800;
    color: var(--text);
    line-height: 1;
  }
  .kpi-change { font-size: 11px; margin-top: 8px; }
  .kpi-change.pos { color: var(--green); }
  .kpi-change.neg { color: var(--red); }

  /* Section headers */
  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }
  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text);
  }
  .section-line { flex: 1; height: 1px; background: var(--border); }

  /* Charts */
  .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
  @media (max-width: 768px) { .charts-grid { grid-template-columns: 1fr; } }

  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
  }
  .chart-title { font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); margin-bottom: 20px; }

  /* Bar chart */
  .bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 140px; }
  .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .bars { display: flex; gap: 3px; align-items: flex-end; width: 100%; }
  .bar {
    flex: 1;
    border-radius: 3px 3px 0 0;
    transition: opacity 0.2s;
    cursor: pointer;
    position: relative;
  }
  .bar:hover { opacity: 0.8; }
  .bar-label { font-size: 9px; color: var(--muted); text-align: center; white-space: nowrap; }

  /* Revenue stacked bars */
  .stacked-bar { flex: 1; display: flex; flex-direction: column; border-radius: 3px; overflow: hidden; }
  .stacked-seg { transition: opacity 0.2s; }
  .stacked-seg:hover { opacity: 0.8; }

  /* Donut */
  .donut-wrap { display: flex; align-items: center; gap: 24px; }
  .donut-legend { display: flex; flex-direction: column; gap: 10px; flex: 1; }
  .legend-item { display: flex; align-items: center; gap: 8px; font-size: 11px; }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .legend-val { margin-left: auto; font-weight: 500; }

  /* Table */
  .table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 40px;
  }
  table { width: 100%; border-collapse: collapse; }
  th {
    font-size: 9px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    padding: 12px 16px;
    text-align: right;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
  }
  th:first-child { text-align: left; }
  td {
    font-size: 12px;
    padding: 12px 16px;
    text-align: right;
    border-bottom: 1px solid var(--border);
  }
  td:first-child { text-align: left; color: var(--muted); }
  tr:last-child td { border-bottom: none; }
  tr.total-row td { font-weight: 500; color: var(--accent); background: rgba(200,255,90,0.04); }
  tr:hover td { background: rgba(255,255,255,0.02); }

  /* Packages */
  .packages-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 40px; }
  @media (max-width: 600px) { .packages-grid { grid-template-columns: 1fr; } }
  .pkg-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    transition: border-color 0.2s;
  }
  .pkg-card:hover { border-color: var(--muted); }
  .pkg-name { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800; margin-bottom: 4px; }
  .pkg-price { font-size: 11px; color: var(--muted); margin-bottom: 16px; }
  .pkg-stat { display: flex; justify-content: space-between; font-size: 11px; padding: 6px 0; border-bottom: 1px solid var(--border); }
  .pkg-stat:last-child { border-bottom: none; }
  .pkg-stat-label { color: var(--muted); }
  .pkg-margin { font-size: 12px; font-weight: 500; margin-top: 12px; padding: 8px 10px; border-radius: 6px; text-align: center; }

  /* Waterfall */
  .waterfall { display: flex; align-items: flex-end; gap: 6px; height: 160px; padding-top: 20px; }
  .wf-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .wf-bar-wrap { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; width: 100%; }
  .wf-bar { width: 100%; border-radius: 3px; min-height: 4px; }
  .wf-label { font-size: 9px; color: var(--muted); text-align: center; line-height: 1.2; }

  /* Footer */
  footer {
    border-top: 1px solid var(--border);
    padding: 24px 0;
    margin-top: 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.08em;
    flex-wrap: wrap;
    gap: 8px;
  }

  /* Animations */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .kpi-card, .chart-card, .table-wrap, .pkg-card {
    animation: fadeUp 0.4s ease both;
  }
  .kpi-card:nth-child(1) { animation-delay: 0.05s; }
  .kpi-card:nth-child(2) { animation-delay: 0.1s; }
  .kpi-card:nth-child(3) { animation-delay: 0.15s; }
  .kpi-card:nth-child(4) { animation-delay: 0.2s; }
  .kpi-card:nth-child(5) { animation-delay: 0.25s; }

  .pill { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 10px; font-weight: 500; }
  .pill-green { background: rgba(74,222,128,0.12); color: var(--green); }
  .pill-yellow { background: rgba(200,255,90,0.12); color: var(--accent); }
  .pill-red { background: rgba(248,113,113,0.12); color: var(--red); }

  svg text { font-family: 'DM Mono', monospace; }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="header-inner">
      <div>
        <div class="brand">RFF — Fractional C-Suite</div>
        <h1>Financial Projections<br><span>2026 — 2028</span></h1>
        <div class="subtitle">Purpose-driven startups &amp; scale-ups · Foundation · Growth · Scale</div>
      </div>
      <div>
        <div class="tabs">
          <button class="tab active" onclick="setYear(2026,this)">2026</button>
          <button class="tab" onclick="setYear(2027,this)">2027</button>
          <button class="tab" onclick="setYear(2028,this)">2028</button>
          <button class="tab" onclick="setYear('all',this)">All Years</button>
        </div>
      </div>
    </div>
  </header>

  <!-- KPI Row -->
  <div id="kpiGrid" class="kpi-grid"></div>

  <!-- Revenue chart + client mix -->
  <div class="section-header">
    <div class="section-title">Revenue</div>
    <div class="section-line"></div>
  </div>
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-title">Monthly Recurring Revenue (MRR) by Package</div>
      <div id="mrrChart"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">Client Mix — End of Year</div>
      <div id="clientMix"></div>
    </div>
  </div>

  <!-- P&L Table -->
  <div class="section-header">
    <div class="section-title">Profit & Loss</div>
    <div class="section-line"></div>
  </div>
  <div class="table-wrap">
    <table id="plTable"></table>
  </div>

  <!-- Packages -->
  <div class="section-header">
    <div class="section-title">Package Economics</div>
    <div class="section-line"></div>
  </div>
  <div class="packages-grid" id="packagesGrid"></div>

  <!-- Headcount chart -->
  <div class="section-header">
    <div class="section-title">Headcount & OPEX</div>
    <div class="section-line"></div>
  </div>
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-title">FTE Ramp (avg per year)</div>
      <div id="fteChart"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">OPEX Breakdown by Category</div>
      <div id="opexChart"></div>
    </div>
  </div>

  <footer>
    <span>RFF Ideation Model · Generated from RFF_Ideation.xlsx</span>
    <span>All figures in EUR · Projections are forecasts, not guarantees</span>
  </footer>
</div>

<script>
// ─── Raw data extracted from Excel ───────────────────────────────────────────

const data = {
  2026: {
    clients: { foundation: 3, growth: 1, scale: 0.5 },
    mrr: { foundation: 20250, growth: 17000, scale: 13500 },
    totalMRR: 50750,
    annualRevenue: 121500,  // from totals col (MRR * months roughly)
    // More precise: avg monthly clients * rate * 12
    revenueByPkg: { foundation: 10125*12, growth: 8500*12, scale: 3375*12 },
    opex: {
      personnel: 45739,      // end of year monthly run-rate
      housing: 3850,
      general: 1475,
      marketing: 1522,
      total_annual: 365000   // sum of monthly OPEX across year
    },
    fte: { CEO: 0.3, CFO: 0.6, CMO: 0.25, CTO: 0.25, HR: 0.25, FinAdmin: 0.45, Backoffice: 0.4, DataEng: 0.2 },
    totalFTE: 2.7,
  },
  2027: {
    clients: { foundation: 8, growth: 2, scale: 2 },
    mrr: { foundation: 56700, growth: 35700, scale: 56700 },
    totalMRR: 149100,
    revenueByPkg: { foundation: 48431*12, growth: 31238*12, scale: 40163*12 },
    opex: {
      personnel: 108782,
      housing: 7700,
      general: 3039,
      marketing: 3135,
      total_annual: 1050000
    },
    fte: { CEO: 0.64, CFO: 1.22, CMO: 1.13, CTO: 1.13, HR: 1.25, FinAdmin: 1.3, Backoffice: 2.32, DataEng: 0.4 },
    totalFTE: 9.4,
  },
  2028: {
    clients: { foundation: 13, growth: 4, scale: 4 },
    mrr: { foundation: 96744, growth: 74970, scale: 119070 },
    totalMRR: 290784,
    revenueByPkg: { foundation: 88062*12, growth: 70284*12, scale: 101706*12 },
    opex: {
      personnel: 196257,
      housing: 11231,
      general: 6259,
      marketing: 7158,
      total_annual: 2200000
    },
    fte: { CEO: 1.45, CFO: 2.25, CMO: 2.25, CTO: 2.35, HR: 2.35, FinAdmin: 2.35, Backoffice: 4.35, DataEng: 0.4 },
    totalFTE: 17.75,
  }
};

// Derived annual revenue (sum avg MRR * 12 ≈)
const annualRevenue = {
  2026: (10125 + 8500 + 3375) * 12,    // ~264,000
  2027: (48431 + 31238 + 40163) * 12,  // ~1,479,984
  2028: (88062 + 70284 + 101706) * 12, // ~3,120,624
};

const annualOpex = { 2026: 437000, 2027: 1050000, 2028: 2200000 };
const ebit = { 2026: annualRevenue[2026] - annualOpex[2026], 2027: annualRevenue[2027] - annualOpex[2027], 2028: annualRevenue[2028] - annualOpex[2028] };

let currentYear = 2026;

function fmt(n, dec=0) {
  if (n === undefined || n === null) return '—';
  const abs = Math.abs(n);
  if (abs >= 1e6) return (n/1e6).toFixed(2) + 'M';
  if (abs >= 1e3) return '€' + Math.round(n).toLocaleString('nl-NL');
  return '€' + n.toFixed(dec);
}

function pct(n) {
  return (n*100).toFixed(1) + '%';
}

function setYear(yr, btn) {
  currentYear = yr;
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function render() {
  renderKPIs();
  renderMRRChart();
  renderClientMix();
  renderPLTable();
  renderPackages();
  renderFTEChart();
  renderOPEXChart();
}

// ─── KPIs ─────────────────────────────────────────────────────────────────────
function renderKPIs() {
  const grid = document.getElementById('kpiGrid');

  if (currentYear === 'all') {
    grid.innerHTML = `
      <div class="kpi-card">
        <div class="kpi-label">Revenue 2026</div>
        <div class="kpi-value">${fmt(annualRevenue[2026])}</div>
        <div class="kpi-change pos">Year 1</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">Revenue 2027</div>
        <div class="kpi-value">${fmt(annualRevenue[2027])}</div>
        <div class="kpi-change pos">↑ ${pct((annualRevenue[2027]-annualRevenue[2026])/annualRevenue[2026])} YoY</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">Revenue 2028</div>
        <div class="kpi-value">${fmt(annualRevenue[2028])}</div>
        <div class="kpi-change pos">↑ ${pct((annualRevenue[2028]-annualRevenue[2027])/annualRevenue[2027])} YoY</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">EBIT 2028</div>
        <div class="kpi-value" style="color:${ebit[2028]>0?'var(--green)':'var(--red)'}">${fmt(ebit[2028])}</div>
        <div class="kpi-change ${ebit[2028]>0?'pos':'neg'}">${pct(ebit[2028]/annualRevenue[2028])} margin</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">Total Clients 2028</div>
        <div class="kpi-value">21</div>
        <div class="kpi-change pos">↑ from 4.5 in 2026</div>
      </div>
    `;
    return;
  }

  const yr = currentYear;
  const d = data[yr];
  const rev = annualRevenue[yr];
  const opx = annualOpex[yr];
  const eb = ebit[yr];
  const prevRev = yr > 2026 ? annualRevenue[yr-1] : null;
  const totalClients = d.clients.foundation + d.clients.growth + d.clients.scale;

  grid.innerHTML = `
    <div class="kpi-card">
      <div class="kpi-label">Annual Revenue</div>
      <div class="kpi-value">${fmt(rev)}</div>
      ${prevRev ? `<div class="kpi-change pos">↑ ${pct((rev-prevRev)/prevRev)} vs ${yr-1}</div>` : '<div class="kpi-change" style="color:var(--muted)">Year 1</div>'}
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Monthly MRR (EOY)</div>
      <div class="kpi-value">${fmt(d.totalMRR)}</div>
      <div class="kpi-change" style="color:var(--muted)">End of ${yr}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Total Clients</div>
      <div class="kpi-value">${totalClients.toFixed(1)}</div>
      <div class="kpi-change" style="color:var(--muted)">Foundation · Growth · Scale</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">EBIT</div>
      <div class="kpi-value" style="color:${eb>0?'var(--green)':'var(--red)'}">${fmt(eb)}</div>
      <div class="kpi-change ${eb>0?'pos':'neg'}">${pct(eb/rev)} margin</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Total FTE</div>
      <div class="kpi-value">${d.totalFTE}</div>
      <div class="kpi-change" style="color:var(--muted)">Avg FTEs across year</div>
    </div>
  `;
}

// ─── MRR Chart ────────────────────────────────────────────────────────────────
function renderMRRChart() {
  const wrap = document.getElementById('mrrChart');

  // Monthly MRR data for each year
  const mrrData = {
    2026: [
      {f:0,g:0,s:0},{f:0,g:0,s:0},{f:0,g:0,s:0},
      {f:6750,g:0,s:0},{f:6750,g:0,s:0},{f:6750,g:0,s:0},
      {f:13500,g:17000,s:0},{f:13500,g:17000,s:0},{f:13500,g:17000,s:0},
      {f:20250,g:17000,s:13500},{f:20250,g:17000,s:13500},{f:20250,g:17000,s:13500}
    ],
    2027: [
      {f:35438,g:17850,s:28350},{f:35438,g:17850,s:28350},{f:42525,g:17850,s:28350},
      {f:42525,g:35700,s:28350},{f:49613,g:35700,s:42525},{f:49613,g:35700,s:42525},
      {f:49613,g:35700,s:42525},{f:49613,g:35700,s:42525},{f:56700,g:35700,s:56700},
      {f:56700,g:35700,s:56700},{f:56700,g:35700,s:56700},{f:56700,g:35700,s:56700}
    ],
    2028: [
      {f:74419,g:56228,s:89303},{f:74419,g:56228,s:89303},{f:81861,g:56228,s:89303},
      {f:81861,g:74970,s:89303},{f:89303,g:74970,s:104186},{f:89303,g:74970,s:104186},
      {f:89303,g:74970,s:104186},{f:89303,g:74970,s:104186},{f:96744,g:74970,s:104186},
      {f:96744,g:74970,s:119070},{f:96744,g:74970,s:119070},{f:96744,g:74970,s:119070}
    ]
  };

  const months = currentYear === 'all'
    ? ['2026','2027','2028']
    : ['J','F','M','A','M','J','J','A','S','O','N','D'];

  let chartData;
  if (currentYear === 'all') {
    chartData = [2026,2027,2028].map(yr => {
      const last = mrrData[yr][11];
      return {f:last.f, g:last.g, s:last.s};
    });
  } else {
    chartData = mrrData[currentYear];
  }

  const maxVal = Math.max(...chartData.map(d => d.f+d.g+d.s));

  const bars = chartData.map((d, i) => {
    const total = d.f + d.g + d.s;
    const fh = maxVal ? (d.f/maxVal*120) : 0;
    const gh = maxVal ? (d.g/maxVal*120) : 0;
    const sh = maxVal ? (d.s/maxVal*120) : 0;
    return `
      <div class="bar-group">
        <div class="bars" style="height:120px">
          <div class="stacked-bar" style="height:${fh+gh+sh}px" title="Total: €${total.toLocaleString('nl-NL')}">
            <div class="stacked-seg" style="flex:${sh};background:#5af0ff;min-height:${sh>0?2:0}px"></div>
            <div class="stacked-seg" style="flex:${gh};background:#c8ff5a;min-height:${gh>0?2:0}px"></div>
            <div class="stacked-seg" style="flex:${fh};background:#5a607a;min-height:${fh>0?2:0}px"></div>
          </div>
        </div>
        <div class="bar-label">${months[i]}</div>
      </div>
    `;
  }).join('');

  wrap.innerHTML = `
    <div class="bar-chart">${bars}</div>
    <div style="display:flex;gap:16px;margin-top:12px">
      <div style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--muted)">
        <div style="width:10px;height:10px;border-radius:2px;background:#5a607a"></div>Foundation
      </div>
      <div style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--muted)">
        <div style="width:10px;height:10px;border-radius:2px;background:#c8ff5a"></div>Growth
      </div>
      <div style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--muted)">
        <div style="width:10px;height:10px;border-radius:2px;background:#5af0ff"></div>Scale
      </div>
    </div>
  `;
}

// ─── Client Mix ───────────────────────────────────────────────────────────────
function renderClientMix() {
  const wrap = document.getElementById('clientMix');

  const clientsByYear = {
    2026: {f:3,g:1,s:0.5},
    2027: {f:8,g:2,s:2},
    2028: {f:13,g:4,s:4}
  };

  const d = currentYear === 'all'
    ? {f:13,g:4,s:4}
    : clientsByYear[currentYear];

  const total = d.f + d.g + d.s;
  const fpct = total ? (d.f/total*100) : 0;
  const gpct = total ? (d.g/total*100) : 0;
  const spct = total ? (d.s/total*100) : 0;

  // SVG donut
  const r = 45, cx = 60, cy = 60, stroke = 18;
  const circum = 2 * Math.PI * r;

  function arc(pct, offset, color) {
    const len = circum * pct / 100;
    return `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${color}" stroke-width="${stroke}" stroke-dasharray="${len} ${circum}" stroke-dashoffset="${-offset * circum / 100}" transform="rotate(-90 ${cx} ${cy})" opacity="0.9"/>`;
  }

  const svgDonut = `
    <svg width="120" height="120" viewBox="0 0 120 120">
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--border)" stroke-width="${stroke}"/>
      ${arc(fpct, 0, '#5a607a')}
      ${arc(gpct, fpct, '#c8ff5a')}
      ${arc(spct, fpct+gpct, '#5af0ff')}
      <text x="${cx}" y="${cy-4}" text-anchor="middle" font-size="18" font-weight="700" fill="var(--text)">${total.toFixed(1)}</text>
      <text x="${cx}" y="${cy+12}" text-anchor="middle" font-size="9" fill="var(--muted)">clients</text>
    </svg>
  `;

  const yr = currentYear === 'all' ? 2028 : currentYear;
  const rates = {
    2026: {f:6750, g:17000, s:27000},
    2027: {f:7088, g:17850, s:28350},
    2028: {f:7442, g:18743, s:29768}
  };
  const r2 = rates[yr];

  wrap.innerHTML = `
    <div class="donut-wrap">
      ${svgDonut}
      <div class="donut-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background:#5a607a"></div>
          <span>Foundation</span>
          <span class="legend-val">${d.f} × ${fmt(r2.f)}</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background:#c8ff5a"></div>
          <span>Growth</span>
          <span class="legend-val">${d.g} × ${fmt(r2.g)}</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background:#5af0ff"></div>
          <span>Scale</span>
          <span class="legend-val">${d.s} × ${fmt(r2.s)}</span>
        </div>
        <div style="border-top:1px solid var(--border);padding-top:8px;font-size:11px;color:var(--muted)">
          MRR (EOY): <span style="color:var(--text);font-weight:500">${fmt(d.f*r2.f + d.g*r2.g + d.s*r2.s)}</span>
        </div>
      </div>
    </div>
  `;
}

// ─── P&L Table ────────────────────────────────────────────────────────────────
function renderPLTable() {
  const table = document.getElementById('plTable');

  const rows = [
    { label: 'Revenue — Foundation', v: {2026: annualRevenue[2026]*0.42, 2027: annualRevenue[2027]*0.41, 2028: annualRevenue[2028]*0.33} },
    { label: 'Revenue — Growth', v: {2026: annualRevenue[2026]*0.34, 2027: annualRevenue[2027]*0.34, 2028: annualRevenue[2028]*0.35} },
    { label: 'Revenue — Scale', v: {2026: annualRevenue[2026]*0.14, 2027: annualRevenue[2027]*0.25, 2028: annualRevenue[2028]*0.32} },
    { label: 'Total Revenue', v: {2026: annualRevenue[2026], 2027: annualRevenue[2027], 2028: annualRevenue[2028]}, total: true },
    { label: 'Personnel Costs', v: {2026: -237000, 2027: -756000, 2028: -1680000} },
    { label: 'Housing', v: {2026: -37800, 2027: -70000, 2028: -134772} },
    { label: 'General & Admin', v: {2026: -17700, 2027: -36462, 2028: -75112} },
    { label: 'Marketing', v: {2026: -18260, 2027: -37615, 2028: -85891} },
    { label: 'Total OPEX', v: {2026: -annualOpex[2026], 2027: -annualOpex[2027], 2028: -annualOpex[2028]}, total: true },
    { label: 'EBIT', v: {2026: ebit[2026], 2027: ebit[2027], 2028: ebit[2028]}, total: true, ebit: true },
    { label: 'EBIT Margin', v: {2026: ebit[2026]/annualRevenue[2026], 2027: ebit[2027]/annualRevenue[2027], 2028: ebit[2028]/annualRevenue[2028]}, margin: true },
  ];

  const years = [2026, 2027, 2028];

  table.innerHTML = `
    <thead>
      <tr>
        <th>P&L Overview</th>
        ${years.map(y => `<th>${y}</th>`).join('')}
      </tr>
    </thead>
    <tbody>
      ${rows.map(row => {
        const isTotal = row.total;
        const isEbit = row.ebit;
        const isMargin = row.margin;

        const cells = years.map(yr => {
          const val = row.v[yr];
          if (isMargin) {
            const cls = val >= 0 ? 'pill pill-green' : 'pill pill-red';
            return `<td><span class="${cls}">${pct(val)}</span></td>`;
          }
          const color = isEbit ? (val >= 0 ? 'var(--green)' : 'var(--red)') : '';
          const style = color ? `style="color:${color}"` : '';
          return `<td ${style}>${fmt(val)}</td>`;
        }).join('');

        return `<tr ${isTotal ? 'class="total-row"' : ''}><td>${row.label}</td>${cells}</tr>`;
      }).join('')}
    </tbody>
  `;
}

// ─── Packages ─────────────────────────────────────────────────────────────────
function renderPackages() {
  const grid = document.getElementById('packagesGrid');
  const yr = currentYear === 'all' ? 2028 : currentYear;

  const rates = { 2026: {f:6750,g:17000,s:27000}, 2027: {f:7088,g:17850,s:28350}, 2028: {f:7442,g:18743,s:29768} };
  const costs = { f:6634, g:16491, s:26829 }; // from Excel
  const r = rates[yr];

  const pkgs = [
    {
      name: 'Foundation',
      color: '#5a607a',
      price: r.f,
      cost: costs.f,
      hours: 32,
      fte: '2–10',
      revenue: '0–3M',
      includes: 'CFO + CMO + CTO + HR + Backoffice'
    },
    {
      name: 'Growth',
      color: '#c8ff5a',
      price: r.g,
      cost: costs.g,
      hours: 132,
      fte: '10–30',
      revenue: '1–8M',
      includes: 'Full C-Suite + HR Admin + Data Engineer'
    },
    {
      name: 'Scale',
      color: '#5af0ff',
      price: r.s,
      cost: costs.s,
      hours: 208,
      fte: '30–100',
      revenue: '6–25M',
      includes: 'Full team · Extended capacity · Premium software'
    }
  ];

  grid.innerHTML = pkgs.map(p => {
    const margin = p.price - p.cost;
    const marginPct = margin / p.price;
    const pillClass = marginPct > 0.05 ? 'pill-green' : marginPct > 0 ? 'pill-yellow' : 'pill-red';
    return `
      <div class="pkg-card" style="border-top:3px solid ${p.color}">
        <div class="pkg-name" style="color:${p.color}">${p.name}</div>
        <div class="pkg-price">${fmt(p.price)}/month · ${p.hours}h included</div>
        <div class="pkg-stat"><span class="pkg-stat-label">Target FTE</span><span>${p.fte}</span></div>
        <div class="pkg-stat"><span class="pkg-stat-label">Target Revenue</span><span>${p.revenue}</span></div>
        <div class="pkg-stat"><span class="pkg-stat-label">Cost of Delivery</span><span>${fmt(p.cost)}</span></div>
        <div class="pkg-stat"><span class="pkg-stat-label">Gross Margin</span><span>${fmt(margin)}</span></div>
        <div class="pkg-margin ${pillClass}" style="border:1px solid currentColor;opacity:0.9">
          Margin: ${pct(marginPct)}
        </div>
        <div style="font-size:10px;color:var(--muted);margin-top:12px">${p.includes}</div>
      </div>
    `;
  }).join('');
}

// ─── FTE Chart ────────────────────────────────────────────────────────────────
function renderFTEChart() {
  const wrap = document.getElementById('fteChart');

  const fteByRole = {
    'CEO': {2026:0.3, 2027:0.64, 2028:1.45},
    'CFO': {2026:0.6, 2027:1.22, 2028:2.25},
    'CMO': {2026:0.25, 2027:1.13, 2028:2.25},
    'CTO': {2026:0.25, 2027:1.13, 2028:2.35},
    'HR Partner': {2026:0.25, 2027:1.25, 2028:2.35},
    'Finance Admin': {2026:0.45, 2027:1.3, 2028:2.35},
    'Backoffice': {2026:0.4, 2027:2.32, 2028:4.35},
    'Data Eng': {2026:0.2, 2027:0.4, 2028:0.4},
  };

  const roles = Object.keys(fteByRole);
  const years = [2026, 2027, 2028];
  const colors = ['#c8ff5a','#5af0ff','#ff7a5a'];

  const maxFTE = 4.35;

  const bars = roles.map(role => {
    const vals = years.map(yr => fteByRole[role][yr]);
    return `
      <div class="bar-group">
        <div class="bars" style="height:120px">
          ${vals.map((v,i) => `<div class="bar" style="height:${(v/maxFTE*120)}px;background:${colors[i]}" title="${role} ${years[i]}: ${v} FTE"></div>`).join('')}
        </div>
        <div class="bar-label">${role.length > 7 ? role.slice(0,6)+'.' : role}</div>
      </div>
    `;
  }).join('');

  wrap.innerHTML = `
    <div class="bar-chart">${bars}</div>
    <div style="display:flex;gap:16px;margin-top:12px">
      ${years.map((y,i) => `<div style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--muted)"><div style="width:10px;height:10px;border-radius:2px;background:${colors[i]}"></div>${y}</div>`).join('')}
    </div>
    <div style="margin-top:12px;font-size:11px;color:var(--muted)">Total FTE: <span style="color:var(--text)">2.7 → 9.4 → 17.8</span></div>
  `;
}

// ─── OPEX Chart ───────────────────────────────────────────────────────────────
function renderOPEXChart() {
  const wrap = document.getElementById('opexChart');

  const opexCats = {
    'Personnel': {2026:237000, 2027:756000, 2028:1680000},
    'Housing':   {2026:37800,  2027:70000,  2028:134772},
    'General':   {2026:17700,  2027:36462,  2028:75112},
    'Marketing': {2026:18260,  2027:37615,  2028:85891},
    'Mgmt Fee':  {2026:96000,  2027:228000, 2028:456000},
  };

  const yr = currentYear === 'all' ? 2028 : currentYear;
  const total = Object.values(opexCats).reduce((s, v) => s + v[yr], 0);
  const cats = Object.entries(opexCats);
  const colors = ['#c8ff5a','#5af0ff','#ff7a5a','#a78bfa','#5a607a'];

  const items = cats.map(([name, vals], i) => {
    const v = vals[yr];
    const w = total ? (v/total*100) : 0;
    return { name, v, w, color: colors[i] };
  });

  // Horizontal bars
  const barHtml = items.map(item => `
    <div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;font-size:10px;margin-bottom:4px">
        <span style="color:var(--muted)">${item.name}</span>
        <span>${fmt(item.v)}</span>
      </div>
      <div style="background:var(--border);border-radius:2px;height:6px;overflow:hidden">
        <div style="width:${item.w}%;height:100%;background:${item.color};border-radius:2px;transition:width 0.4s ease"></div>
      </div>
    </div>
  `).join('');

  wrap.innerHTML = `
    ${barHtml}
    <div style="border-top:1px solid var(--border);padding-top:10px;font-size:11px;color:var(--muted)">
      Total OPEX: <span style="color:var(--text);font-weight:500">${fmt(total)}</span>
    </div>
  `;
}

// ─── Init ─────────────────────────────────────────────────────────────────────
render();
</script>
</body>
</html>
